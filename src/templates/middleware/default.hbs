/**
 * {{name}}Interceptor
 * 
 * A pure TypeScript interceptor class implementing IInterceptor.
 * Generated by @struktos/cli on {{timestamp}}
 * 
 * Usage:
 *   app.use(new {{name}}Interceptor());
 */

import { RequestContext, IInterceptor, NextFn } from '{{coreImports.IInterceptor}}';
import { Observable, tap, catchError, throwError } from 'rxjs';

/**
 * {{name}} Interceptor
 * 
 * Intercepts requests and responses in the middleware pipeline.
 * No decorators - pure TypeScript class.
 */
export class {{name}}Interceptor implements IInterceptor {
  private readonly name = '{{name}}Interceptor';

  /**
   * Constructor for dependency injection
{{#if withLogger}}
   * @param logger - Logger instance for tracking operations
{{/if}}
   */
  constructor(
{{#if withLogger}}
    // private readonly logger: ILogger,
{{/if}}
  ) {}

  /**
   * Intercept the request/response flow
   * 
   * @param context - The request context with trace ID and metadata
   * @param next - Function to call the next handler in the chain
   * @returns Observable of the response
   */
  intercept(context: RequestContext, next: NextFn): Observable<any> {
    const start = Date.now();
    const traceId = context.get('traceId') || 'unknown';
    const methodName = context.get('methodName') || context.get('route') || 'unknown';

    // Pre-processing
    console.log(`[${this.name}] [START] ${methodName} (Trace: ${traceId})`);

    return next().pipe(
      // Post-processing on success
      tap((response) => {
        const duration = Date.now() - start;
        console.log(`[${this.name}] [END] ${methodName} completed in ${duration}ms`);
        
        // TODO: Add your success handling logic here
      }),

      // Error handling
      catchError((error) => {
        const duration = Date.now() - start;
        console.error(`[${this.name}] [ERROR] ${methodName} failed after ${duration}ms:`, error.message);
        
        // TODO: Add your error handling logic here
        
        return throwError(() => error);
      })
    );
  }
}

/**
 * Factory function for creating the interceptor
 */
export function create{{name}}Interceptor(): {{name}}Interceptor {
  return new {{name}}Interceptor();
}